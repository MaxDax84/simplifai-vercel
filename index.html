<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SimplifAI Clone</title>
<link rel="stylesheet" href="/theme.css">

<style>
.wrap{width:min(1100px,92vw);margin:0 auto;}
.section{margin-top:24px;}
.card{padding:22px;border-radius:18px;}
.badge{font-size:12px;color:var(--muted);margin-bottom:8px;}
.title{font-weight:900;font-size:20px;margin-bottom:6px;}
.sub{color:var(--muted);font-size:14px;margin-bottom:14px;}

textarea{
  width:100%;
  min-height:180px;
  background:rgba(0,0,0,.22);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  color:var(--text);
  font-size:14px;
}

.actions{
  display:flex;
  justify-content:space-between;
  margin-top:14px;
  flex-wrap:wrap;
  gap:10px;
}

.targets-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){
  .targets-grid{grid-template-columns:1fr;}
}

.target-card{
  border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  border-radius:16px;
  padding:14px;
  display:flex;
  gap:12px;
  cursor:pointer;
  transition:.15s ease;
}
.target-card:hover{background:rgba(255,255,255,.05);}
.target-card.active{
  border-color:rgba(124,92,255,.55);
  background:rgba(124,92,255,.14);
}

.ticon{
  width:38px;height:38px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,.06);
  border-radius:12px;
  font-size:18px;
}

.response-card{
  background:rgba(0,0,0,.18);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  min-height:240px;
  display:flex;
  flex-direction:column;
}

.response-text{
  white-space:pre-wrap;
  line-height:1.6;
  flex:1;
}

.status{
  font-size:12px;
  color:var(--muted);
  display:flex;
  align-items:center;
  gap:10px;
}

.spinner{
  width:14px;height:14px;
  border:2px solid rgba(255,255,255,.25);
  border-top-color:white;
  border-radius:50%;
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="wrap">

<header>
<div class="brand">
<div class="logo"></div>
<div>
<h1>SimplifAI Clone</h1>
<span>Risposte su misura</span>
</div>
</div>
</header>

<!-- STEP 1 -->
<section class="section" id="sec1">
<div class="card">
<div class="badge">1) Domanda</div>
<div class="title">Scrivi la domanda</div>
<div class="sub">Inserisci la domanda e poi scegli il target.</div>

<textarea id="query" placeholder="Esempio: Cos'Ã¨ il DNA e a cosa serve?"></textarea>

<div class="actions">
<div></div>
<button class="btn btn-primary" id="goTargets">Scegli target â†“</button>
</div>
</div>
</section>

<!-- STEP 2 -->
<section class="section" id="sec2">
<div class="card">
<div class="badge">2) Target</div>
<div class="title">Seleziona il target</div>
<div class="sub">Clicca un target per generare automaticamente la risposta.</div>

<div class="targets-grid" id="targets"></div>

<div class="actions">
<button class="btn" id="backToQ">â†‘ Torna alla domanda</button>
</div>
</div>
</section>

<!-- STEP 3 -->
<section class="section" id="sec3">
<div class="card">
<div class="badge">3) Risposta</div>
<div class="title">Risposta</div>

<div class="response-card">
<div class="response-text" id="response"></div>

<div class="actions">
<div class="status">
<span id="spinner" class="spinner" style="display:none"></span>
<span id="status">Pronto.</span>
</div>

<div style="display:flex;gap:10px;">
<button class="btn" id="copyBtn">Copia</button>
<button class="btn btn-primary" id="generateBtn">Genera</button>
</div>
</div>

</div>
</div>
</section>

</div>

<script>
const TARGETS = [
{label:"Bambino",icon:"ðŸ§’",prompt:"Spiega come a un bambino."},
{label:"Ragazzino",icon:"ðŸ§‘â€ðŸŽ“",prompt:"Spiega come a un ragazzino."},
{label:"Universitario",icon:"ðŸŽ“",prompt:"Spiega come a uno studente universitario."},
{label:"Adulto",icon:"ðŸ§‘",prompt:"Spiega come a un adulto."},
{label:"Esperto",icon:"ðŸ§ ",prompt:"Spiega come a un esperto."},
{label:"Scienziato",icon:"ðŸ§ª",prompt:"Spiega come a uno scienziato con rigore tecnico."}
];

let selectedIndex=-1;
let accumulated="";
let generating=false;

const q=document.getElementById("query");
const targetsEl=document.getElementById("targets");
const responseEl=document.getElementById("response");
const spinner=document.getElementById("spinner");
const statusEl=document.getElementById("status");
const generateBtn=document.getElementById("generateBtn");

function scrollToSection(id){
document.getElementById(id).scrollIntoView({behavior:"smooth"});
}

function setStatus(t,load=false){
statusEl.textContent=t;
spinner.style.display=load?"inline-block":"none";
}

function renderTargets(){
targetsEl.innerHTML="";
TARGETS.forEach((t,i)=>{
const el=document.createElement("div");
el.className="target-card"+(i===selectedIndex?" active":"");
el.innerHTML=`<div class="ticon">${t.icon}</div><div><b>${t.label}</b></div>`;
el.onclick=()=>{
selectedIndex=i;
renderTargets();
scrollToSection("sec3");
preflight();
setTimeout(()=>run(),250);
};
targetsEl.appendChild(el);
});
}
renderTargets();

function preflight(){
accumulated="";
responseEl.textContent="";
setStatus("Ok! Sto generandoâ€¦",true);
generating=true;
}

async function run(){
if(generating===false)return;
if(!q.value.trim()){scrollToSection("sec1");return;}
if(selectedIndex<0){scrollToSection("sec2");return;}

try{
const res=await fetch("/api/gemini",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
query:q.value,
targetPrompt:TARGETS[selectedIndex].prompt
})
});

if(!res.ok){
setStatus("Errore.",false);
generating=false;
return;
}

const reader=res.body.getReader();
const decoder=new TextDecoder();
let done=false;

while(!done){
const {value,done:doneReading}=await reader.read();
done=doneReading;
if(value){
const chunk=decoder.decode(value);
responseEl.textContent+=chunk;
}
}

setStatus("Fatto.",false);
generating=false;

}catch(e){
setStatus("Errore.",false);
generating=false;
}
}

document.getElementById("goTargets").onclick=()=>{
if(!q.value.trim()){q.focus();return;}
scrollToSection("sec2");
};

document.getElementById("backToQ").onclick=()=>scrollToSection("sec1");
generateBtn.onclick=()=>{generating=true;run();};

document.getElementById("copyBtn").onclick=()=>{
navigator.clipboard.writeText(responseEl.textContent);
};
</script>
</body>
</html>
